<div class="card">
  <mat-card>
    <ng-container *ngIf="operationToEdit | async as edit; else list">
      <mat-card-header>
        <mat-card-title>Bearbeiten</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form class="edit-form">
          <mat-form-field class="full-width" appearance="fill">
            <mat-label>Name</mat-label>
            <input matInput type="text" placeholder="Name eingeben" [(ngModel)]="edit.name" name="name" />
          </mat-form-field>
          <mat-form-field class="full-width" appearance="fill">
            <mat-label>Beschreibung</mat-label>
            <input matInput type="text" placeholder="Beschreibung eingeben" [(ngModel)]="edit.description" name="description" />
          </mat-form-field>
        </form>
      </mat-card-content>
      <mat-card-actions>
        <button class="button" mat-raised-button color="primary" (click)="saveOperation(edit)">Speichern</button>
        <button class="button" mat-raised-button color="error" (click)="deleteOperation()">Löschen</button>
        <button class="button" mat-button (click)="operationToEdit.next(undefined)">Abbrechen</button>
      </mat-card-actions>
    </ng-container>

    <ng-template #list>
      <mat-card-header>
        <mat-card-title>Ereignis auswählen</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list>
          <mat-list-item *ngFor="let o of operations | async">
            <matListItemLine matListItemTitle>{{ o.name }}</matListItemLine>
            <div matListItemLine>{{ o.description }}</div>

            <div matListItemMeta style="display: flex;">
              <button mat-icon-button aria-label="Edit" (click)="selectOperation(o)">
                <mat-icon>open_in_browser</mat-icon>
              </button>
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options">
                <mat-icon>more_vert</mat-icon>
              </button>
            </div>

            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="operationToEdit.next(o)">
                <mat-icon aria-hidden="false">edit</mat-icon>
                Ereignis umbenennen
              </button>
              <button
                mat-menu-item
                (click)="exportOperation()"
              >
                <mat-icon aria-hidden="false" [attr.aria-label]="i18n.get('exportOperation')">save</mat-icon>
                {{ i18n.get('exportOperation') }}
              </button>
            </mat-menu>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
      <mat-card-actions style="display: flex; gap: 4px">
        <button mat-raised-button color="primary" (click)="createOperation()">Neues Ereignis</button>
        <button mat-raised-button color="primary" (click)="importOperation()">Ereignis importieren</button>
        <button mat-raised-button (click)="logout()">Logout</button>
      </mat-card-actions>
    </ng-template>
  </mat-card>
</div>
